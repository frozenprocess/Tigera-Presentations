package_update: true
packages:
  - docker-registry
  - docker.io
users:
  - default
write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKQVJDSD1gdW5hbWUgLW1gCmlmIFtbICRBUkNIID09ICJ4ODZfNjQiIF1dCnRoZW4KZWNobyAiRG93bmxvYWRpbmcgazNzIGJpbmFyeSBmb3IgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL2szcy1pby9rM3MvcmVsZWFzZXMvZG93bmxvYWQvdjEuMjMuMTYlMkJrM3MxL2szcyAtbyAvdXNyL2xvY2FsL2Jpbi9rM3MKZWNobyAiRG93bmxvYWRpbmcgY2FsaWNvY3RsIGJpbmFyeSAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vcHJvamVjdGNhbGljby9jYWxpY28vcmVsZWFzZXMvbGF0ZXN0L2Rvd25sb2FkL2NhbGljb2N0bC1saW51eC1hbWQ2NCAtbyAvdXNyL2xvY2FsL2Jpbi9jYWxpY29jdGwKZWxzZQplY2hvICJEb3dubG9hZGluZyBrM3MgYmluYXJ5IGZvciAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vazNzLWlvL2szcy9yZWxlYXNlcy9kb3dubG9hZC92MS4yMy4xNiUyQmszczEvazNzLWFybTY0IC1vIC91c3IvbG9jYWwvYmluL2szcwplY2hvICJEb3dubG9hZGluZyBjYWxpY29jdGwgYmluYXJ5ICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0Y2FsaWNvL2NhbGljby9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2FsaWNvY3RsLWxpbnV4LWFybTY0IC1vIC91c3IvbG9jYWwvYmluL2NhbGljb2N0bApmaQoKL3Vzci9iaW4vY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vazNzCi91c3IvYmluL2NobW9kICt4IC91c3IvbG9jYWwvYmluL2NhbGljb2N0bCAKCi91c3IvYmluL2N1cmwgaHR0cHM6Ly9nZXQuazNzLmlvLyA+IC9yb290L2luc3RhbGwuc2gKL3Vzci9iaW4vY2htb2QgK3ggL3Jvb3QvaW5zdGFsbC5zaAoKIyBNYWMgT1MgZGlzY292ZXJ5IGZpeApjYXQgPj4gL2V0Yy9zeXN0ZW1kL3Jlc29sdmVkLmNvbmYgPDwtRU9GCk11bHRpY2FzdEROUz15ZXMKRG9tYWlucz1tdWx0aXBhc3MgbXNob21lLm5ldCBsb2NhbApFT0YKL3Vzci9iaW4vc3lzdGVtY3RsIGVuYWJsZSBzeXN0ZW1kLXJlc29sdmVkLnNlcnZpY2UKL3Vzci9iaW4vc3lzdGVtY3RsIHJlc3RhcnQgc3lzdGVtZC1yZXNvbHZlZC5zZXJ2aWNlCgpjYXQgPiAvZXRjL3N5c3RlbWQvc3lzdGVtL21kbnNALnNlcnZpY2UgPDwtRU9GCltTZXJ2aWNlXQpUeXBlPW9uZXNob3QKRXhlY1N0YXJ0PS91c3IvYmluL3Jlc29sdmVjdGwgbWRucyAlaSB5ZXMKQWZ0ZXI9c3lzLXN1YnN5c3RlbS1uZXQtZGV2aWNlcy0laS5kZXZpY2UKCltJbnN0YWxsXQpXYW50ZWRCeT1zeXMtc3Vic3lzdGVtLW5ldC1kZXZpY2VzLSVpLmRldmljZQpFT0YKCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgbWRuc0BlbnAwczEuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgc3RhcnQgbWRuc0BlbnAwczEuc2VydmljZQojIE1hYyBPUyBkaXNjb3ZlcnkgZml4Cg==
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: dmVyc2lvbjogMC4xCmxvZzoKICBmaWVsZHM6CiAgICBzZXJ2aWNlOiByZWdpc3RyeQpzdG9yYWdlOgogIGNhY2hlOgogICAgYmxvYmRlc2NyaXB0b3I6IGlubWVtb3J5CiAgZmlsZXN5c3RlbToKICAgIHJvb3RkaXJlY3Rvcnk6IC92YXIvbGliL2RvY2tlci1yZWdpc3RyeQogIGRlbGV0ZToKICAgIGVuYWJsZWQ6IHRydWUKaHR0cDoKICBhZGRyOiAwLjAuMC4wOjUwMDAKICBoZWFkZXJzOgogICAgWC1Db250ZW50LVR5cGUtT3B0aW9uczogW25vc25pZmZdCiAgdGxzOgogICAgY2VydGlmaWNhdGU6IC9ldGMvZG9ja2VyL3JlZ2lzdHJ5L2NhLmNydAogICAga2V5OiAvZXRjL2RvY2tlci9yZWdpc3RyeS9jYS5rZXkKaGVhbHRoOgogIHN0b3JhZ2Vkcml2ZXI6CiAgICBlbmFibGVkOiB0cnVlCiAgICBpbnRlcnZhbDogMTBzCiAgICB0aHJlc2hvbGQ6IDMK
  owner: root:root
  path: /etc/docker/registry/config.yml
- encoding: b64
  content: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR6RENDQXJTZ0F3SUJBZ0lVSTV5NjdVZmFhbnplNUF5dlJBNUVBUkNEelNFd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1BURVZNQk1HQTFVRUF3d01jSEpwZG1GMFpTMXlaWEJ2TVJjd0ZRWURWUVFLREE1WFpTQnNiM1psSUVOaApiR2xqYnpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTWpNd016STFNVGd5TXpFMVdoY05Nall3TVRFeU1UZ3lNekUxCldqQTlNUlV3RXdZRFZRUUREQXh3Y21sMllYUmxMWEpsY0c4eEZ6QVZCZ05WQkFvTURsZGxJR3h2ZG1VZ1EyRnMKYVdOdk1Rc3dDUVlEVlFRR0V3SlZVekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQgpBTHRXR3JTSklHWEJVNndqamJHMWtZUEJPT0NmOFFMS00yR0E5ckNCYmttbVRxc0JBcnNyVlpqdW80alA1YklXCndjN1BadVkrT29WMll2dnFhVkwxS0pDV3ZwcVZmbGhKZEJ4Q1cvYjNhc0NGY2h6RERONUdKZEhiWDlNZlpSSWwKMDRKcDg5M0Nyd1A1VWF5cjRnbUM4Z2M5eTVYdGUzKzlxZWhwWWcyMUxCMHB6T09zelFHSitMMG9TREx1NWZQNQpPUW9IeUdQSUo0RG5RWEtibEFxeGY1eDU2bklCZ3dGQlJuZExnM2pVWlpGR3lOTHZxd2pDRWgwSXpyUzdHL3IwCkJncVB0VFdwZ2RLMUtYYmd6RkRmYkFqVDRmb3RQRFRKbmYzWitsRVdzZmM1alVnVVpySzNmejBIQzBRakc0NWgKRHJoS3JPOXZVOHJ6RE5wdjZFMENlZjhDQXdFQUFhT0J3ekNCd0RBTEJnTlZIUThFQkFNQ0JEQXdFd1lEVlIwbApCQXd3Q2dZSUt3WUJCUVVIQXdFd1hBWURWUjBSQkZVd1U0SVdjSEpwZG1GMFpTMXlaWEJ2TG0xMWJIUnBjR0Z6CmM0SVhjSEpwZG1GMFpTMXlaWEJ2TG0xemFHOXRaUzV1WlhTQ0VuQnlhWFpoZEdVdGNtVndieTVzYjJOaGJJSU0KY0hKcGRtRjBaUzF5WlhCdk1CMEdBMVVkRGdRV0JCU3ZMNDBHMExJa1Jrdm9SbHM4SnVWdVU0NGhNVEFmQmdOVgpIU01FR0RBV2dCUnUraG4xZUFseno0NHBZU0U0eE5FWU5HMmVoREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBCmV3NGVqNXhkUzBtQ3U5bldOU3NneUlGekFweHFaOVNDMTdFQnBOaDdGSFE1b1BPeGZ3NExxQkJWSEdQUFlnekYKcGplZDBzSFJHL2lzYXRabC81T2x1azYvOU9kcGl2VVdRblhiUnY4TlZVYjFLYkZnb3FzUG5rR2wwamNMdUVoSAp6aGVnZlp3OWxIMjV1ekJ2a0R1V0YvZWk0L0EybmczcjFVSmZIZmpMQllHNkk1L05RdW96b3h4UTNKMHZwSVdQCnFkUlkzMzJzNU9sb3pRbXVGR2EvZzRDdmc0L1VXaDZtNUlFYnRJS0NCMmdjSHRlRnE3ZlFkR2FJK3ZGZXJqV0kKZERFZ21GVDhNdmx5Mk5ORUxNUGxCRVFFSkhJRFMxak85NlZLelRhR3E1TVcrS01vV2R4RXVlVzN5MXR3TEoxZAp5eTVsdmRIa2dwWURrNHpWWmswQk9nPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  owner: root:root
  path: /etc/docker/registry/ca.crt
- encoding: b64
  content: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQzdWaHEwaVNCbHdWT3MKSTQyeHRaR0R3VGpnbi9FQ3lqTmhnUGF3Z1c1SnBrNnJBUUs3SzFXWTdxT0l6K1d5RnNIT3oyYm1QanFGZG1MNwo2bWxTOVNpUWxyNmFsWDVZU1hRY1FsdjI5MnJBaFhJY3d3emVSaVhSMjEvVEgyVVNKZE9DYWZQZHdxOEQrVkdzCnErSUpndklIUGN1VjdYdC92YW5vYVdJTnRTd2RLY3pqck0wQmlmaTlLRWd5N3VYeitUa0tCOGhqeUNlQTUwRnkKbTVRS3NYK2NlZXB5QVlNQlFVWjNTNE40MUdXUlJzalM3NnNJd2hJZENNNjB1eHY2OUFZS2o3VTFxWUhTdFNsMgo0TXhRMzJ3STArSDZMVHcweVozOTJmcFJGckgzT1kxSUZHYXl0Mzg5Qnd0RUl4dU9ZUTY0U3F6dmIxUEs4d3phCmIraE5Bbm4vQWdNQkFBRUNnZ0VBVERZZndDRm5IaTVUb1Z5SGFPdmlTblVCZEJSdFFvTEsrMWd4UTZZc0hXYzgKYXNJSy8rVUZ1aVVmUDJuQVdyNTZVdTI2UVdIQWdnb2pBN1FkN0FOVFlOc0txSzIzakNnNXhjTlRVWG5mSW5wSApiWjhHTGFqZyt1cGhwZXlJUENWS1VpeFRhdnlvSVpnOG0yQURvWFgxaTIrZTBwd2QyVjVwOEdScTRRTzY4aE9jCmpaV1g3MGFiYnhNZzUvS2RnS0pMNmFWUy9DQ1BlM2RmdlU0Z2NodFZmczh5Qk42aDE3NnF6Vzh3WGVtV2RGdE0KZmFiRWptRlRWM1NyL3BybEtHOXhRU1UxVTVlTTh3Y0pvOTY4VUNDSjRXWmVtQ1FDUUJzbnBRTGFvVFl4OVlnVApkZW14SnBhODdEcDBmNm5NT3FnOFFRaVpBdGFqMzR4Mk5qRW43RE1DZVFLQmdRRGdGSkw5YWxpWEZ6WjI4d0VoCmFZc2VhbS9jTmUxV1ZPMTBRMERPTW5wSWJldGZKUU8rZGk5UUNtT0pTYU9BM3FKcHYvRjc3MEN4MXlRVkI1cTYKbUpIVUxuc3JTRWhocEdUcGFsTUEzZ2s3Rm9BQU00RENqMm43bXZZV0NzaU84bW5zYmZnM2NGamV3TTlDa1lERAp0QmdDekwvb0dZemd0cUMyUldBRFNDWSt1UUtCZ1FEV0JacTRjbEpFQ3orWThaVUt6eitoYTNCTW16U0J5djViCkNVMisyTzdpUGcvZVVwWjBXWVVKSDhLVnNmSGJ3UlN5Qm0rZEVyZk9qK1VWK2U3TnNLdmZjUGVQaGJNZTBrM0UKT1czcmFod3FLSjUxcXlzUDlrWmpmTnFJaUhSQktXSmF2QWtkWFEzazg1MElqY2VFanpMNlFBVkp4MVlYb1NPcApPODN4Y0x6aWR3S0JnRkRwSE9wRUxCamlXTmc2aG4zNkRqRzlYUWEyc2l3cUhsT010U20vTUVoVzZGWkNsMGQrCmhUYnhpVjlaSjZDd3d4Uk1LbllGdmVaNU9KNGZVTTl2cDdobDBET2d0Z0lMeWlRK01CcHdFZ1V6NnFRbjlLWk0KQW9qSE8zUmFFSEVOTnhJWDR6aWhhSFdHU1ZCUUdaNlF1TnJKODhGcStHTnJqanhDY0ppK3hKQ0JBb0dCQUx3RgpTbXEyREcyNDBCTm1VUUNoR0E2UW02VEJTVHlwZ0JHc043L3RSdGc5bTZVK091MVdZOWlqTFVoamZzNEhiMDRDCjkzVXZwNGp4dzFrdUxFeEo1SVMwOHRnRXBscnllTjFsY3BxNXFxcWk2cXNIU0JxS3lrWEd2eG5wZnZCc0Vmc1MKYkpOK1Y2R0hIN01QRTNQeWRkK0I5T05mR3RSQmZWbkVyMlZvSEpoN0FvR0FiMUdhVFlPL3lNL2VOOUQ0aTErSgpPMWhzTUg4Nmh1M2IxT1NJRGdzZ1BOeis1U0JKejVKUlRxV0FhcGhmbEh0NU9kRUVEMjVrOWdGTjh3UHdQVUNwClJMZTcwazBQZjZ1WVRWbFhpTUt1dEZacG5oeWI0VFdMY0IwQW1FL3ZFZVF0WWEwRVhhbkhJTHJSVmZNSFgrQkwKVytiK1JHdklBOWRyNnVjWmN6Q0NHVXM9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
  owner: root:root
  path: /etc/docker/registry/ca.key

disable_root: false
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud
runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh ]
  - [ /root/prepare.sh ]
  - [ /usr/sbin/usermod -aG docker ubuntu ]
  - [ /usr/bin/systemctl, enable, docker.service ]
  - [ /usr/bin/systemctl, enable, docker-registry.service ]
