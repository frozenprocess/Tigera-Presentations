package_update: true
packages:
  - docker-registry
  - docker.io
users:
  - default
write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKI0szU19WRVJTSU9OPSJ2MS4yMy4xNiUyQmszczEiCiNLM1NfVkVSU0lPTj0idjEuMjUuOCUyQmszczEiCkszU19WRVJTSU9OPSQxCgpBUkNIPWB1bmFtZSAtbWAKaWYgW1sgJEFSQ0ggPT0gIng4Nl82NCIgXV0KdGhlbgplY2hvICJEb3dubG9hZGluZyBrM3MgYmluYXJ5IGZvciAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vazNzLWlvL2szcy9yZWxlYXNlcy9kb3dubG9hZC8kSzNTX1ZFUlNJT04vazNzIC1vIC91c3IvbG9jYWwvYmluL2szcwplY2hvICJEb3dubG9hZGluZyBjYWxpY29jdGwgYmluYXJ5ICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0Y2FsaWNvL2NhbGljby9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2FsaWNvY3RsLWxpbnV4LWFtZDY0IC1vIC91c3IvbG9jYWwvYmluL2NhbGljb2N0bAplbHNlCmVjaG8gIkRvd25sb2FkaW5nIGszcyBiaW5hcnkgZm9yICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9rM3MtaW8vazNzL3JlbGVhc2VzL2Rvd25sb2FkLyRLM1NfVkVSU0lPTi9rM3MtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vazNzCmVjaG8gIkRvd25sb2FkaW5nIGNhbGljb2N0bCBiaW5hcnkgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RjYWxpY28vY2FsaWNvL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jYWxpY29jdGwtbGludXgtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsCmZpCgovdXNyL2Jpbi9jaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9rM3MKL3Vzci9iaW4vY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsIAoKL3Vzci9iaW4vY3VybCBodHRwczovL2dldC5rM3MuaW8vID4gL3Jvb3QvaW5zdGFsbC5zaAovdXNyL2Jpbi9jaG1vZCAreCAvcm9vdC9pbnN0YWxsLnNoCgojIE1hYyBPUyBkaXNjb3ZlcnkgZml4CmNhdCA+PiAvZXRjL3N5c3RlbWQvcmVzb2x2ZWQuY29uZiA8PC1FT0YKTXVsdGljYXN0RE5TPXllcwpEb21haW5zPW11bHRpcGFzcyBtc2hvbWUubmV0IGxvY2FsCkVPRgovdXNyL2Jpbi9zeXN0ZW1jdGwgZW5hYmxlIHN5c3RlbWQtcmVzb2x2ZWQuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBzeXN0ZW1kLXJlc29sdmVkLnNlcnZpY2UKCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vbWRuc0Auc2VydmljZSA8PC1FT0YKW1NlcnZpY2VdClR5cGU9b25lc2hvdApFeGVjU3RhcnQ9L3Vzci9iaW4vcmVzb2x2ZWN0bCBtZG5zICVpIHllcwpBZnRlcj1zeXMtc3Vic3lzdGVtLW5ldC1kZXZpY2VzLSVpLmRldmljZQoKW0luc3RhbGxdCldhbnRlZEJ5PXN5cy1zdWJzeXN0ZW0tbmV0LWRldmljZXMtJWkuZGV2aWNlCkVPRgoKSU5URVJGQUNFPWBpcCBsaW5rIHNob3cgIHwgZWdyZXAgIlswLTldOiBlbiIgfCBhd2sgJ3sgcHJpbnQgJDIgfScgfCBjdXQgLWQ6IC1mMWAKCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgbWRuc0AkSU5URVJGQUNFLnNlcnZpY2UKL3Vzci9iaW4vc3lzdGVtY3RsIHN0YXJ0IG1kbnNAJElOVEVSRkFDRS5zZXJ2aWNlCiMgTWFjIE9TIGRpc2NvdmVyeSBmaXgK
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: dmVyc2lvbjogMC4xCmxvZzoKICBmaWVsZHM6CiAgICBzZXJ2aWNlOiByZWdpc3RyeQpzdG9yYWdlOgogIGNhY2hlOgogICAgYmxvYmRlc2NyaXB0b3I6IGlubWVtb3J5CiAgZmlsZXN5c3RlbToKICAgIHJvb3RkaXJlY3Rvcnk6IC92YXIvbGliL2RvY2tlci1yZWdpc3RyeQogIGRlbGV0ZToKICAgIGVuYWJsZWQ6IHRydWUKaHR0cDoKICBhZGRyOiAwLjAuMC4wOjUwMDAKICBoZWFkZXJzOgogICAgWC1Db250ZW50LVR5cGUtT3B0aW9uczogW25vc25pZmZdCiAgdGxzOgogICAgY2VydGlmaWNhdGU6IC9ldGMvZG9ja2VyL3JlZ2lzdHJ5L2NhLmNydAogICAga2V5OiAvZXRjL2RvY2tlci9yZWdpc3RyeS9jYS5rZXkKaGVhbHRoOgogIHN0b3JhZ2Vkcml2ZXI6CiAgICBlbmFibGVkOiB0cnVlCiAgICBpbnRlcnZhbDogMTBzCiAgICB0aHJlc2hvbGQ6IDMK
  owner: root:root
  path: /etc/docker/registry/config.yml
- encoding: b64
  content: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR6RENDQXJTZ0F3SUJBZ0lVRGZ4VjJ1ME5vVkxWUHpEZkJUaWcwdG16WmJjd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1BURVZNQk1HQTFVRUF3d01jSEpwZG1GMFpTMXlaWEJ2TVJjd0ZRWURWUVFLREE1WFpTQnNiM1psSUVOaApiR2xqYnpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTWpNd05qSTVNVFUxTXpBNFdoY05Nall3TkRFNE1UVTFNekE0CldqQTlNUlV3RXdZRFZRUUREQXh3Y21sMllYUmxMWEpsY0c4eEZ6QVZCZ05WQkFvTURsZGxJR3h2ZG1VZ1EyRnMKYVdOdk1Rc3dDUVlEVlFRR0V3SlZVekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQgpBTGYrTFBKakV6ZVVGaStlNVdhSTdaUFNRS0lpNXVvOHpyc1Z1a2Zvem96Q3c1M29WMWhEU3E0MkhwR3pTeTZVClFSWW1iZlRhME8yMGl1K3dMbzZPMEhDTEptajRrWE50bU5WcUE5K0FhbHBBdWwvQlJrcVdPNEtlbFlQTVJOL1kKczY3akh5WjRzeHRCTzFlMXFXa0hNUklBb0QrTzZNT3dlZ0ZKUUFibEJHdWthM2pLRkhESS9uRFpsakhrQk9vaQpLMVFGTWJ3OTRUZGVMOTM3RW93U1M4TWt1RzZYYmdTM2VPRHdjUlpjaTlTNHNqbzBWQXU0Q2IycFk0b3hOcjFsCnlCQlhmbXpUWkhVcmEyREVyRXdJZituWU44SzNwWnFOcEx3VUhtT1ptc1lFUHl5OVpaZEZ4Q3FqL3FEd2RjMFYKTGkzVDRCUkJkNEJGNnd3N2VlajdNZjBDQXdFQUFhT0J3ekNCd0RBTEJnTlZIUThFQkFNQ0JEQXdFd1lEVlIwbApCQXd3Q2dZSUt3WUJCUVVIQXdFd1hBWURWUjBSQkZVd1U0SVdjSEpwZG1GMFpTMXlaWEJ2TG0xMWJIUnBjR0Z6CmM0SVhjSEpwZG1GMFpTMXlaWEJ2TG0xemFHOXRaUzV1WlhTQ0VuQnlhWFpoZEdVdGNtVndieTVzYjJOaGJJSU0KY0hKcGRtRjBaUzF5WlhCdk1CMEdBMVVkRGdRV0JCVEZsWXdkTVZabVk0ZnJSY25teWFaaGsvL3UrakFmQmdOVgpIU01FR0RBV2dCU3M1NzRXQ1lNVVlLMGlWVmtNWHp2YlMwOHFxREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBClc0NjdZN3l6eENJalZyS29uSEpLajZYbnQ1aXpUREJjUVJaaW50c0RlZnFqdFluaW1FWFB5clFGSkdpVktyM1UKWUlnVjV4K3ZjaDNBT2tQeExFWWU0a1hKdVVCYXdIazhLblV1NG03dERQSnRZOGovUGRwMHphZE4vbkwrRGU0NwpRSFdTRGltQ1lIb0tlcHBac2hvODhQOXFFckNCd2hrQWR6MEFtQ3U3eFVwSDNUTDN4N2NIT0xYeVFlbFRDVllUCjM3S0N0UnprWnpPbi9CZWFsR0xyUEpUaVZ4VjNOR2drMGtOdzl2MjM5U0NIblVhSEFjVDV0Y2VpZ211RkUySFgKVXE0aEhVL3pvMC8vcENqNmZYUXlOUVFJdzJJZGJJZkNiU2VCamROdEZ1aHhwbWhRSi9WemwvWGc3VkZoYUNHbgpVZnBJeVR5b3pWb1hJTGxIZ1lOZXN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  owner: root:root
  path: /etc/docker/registry/ca.crt
- encoding: b64
  content: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQzMvaXp5WXhNM2xCWXYKbnVWbWlPMlQwa0NpSXVicVBNNjdGYnBINk02TXdzT2Q2RmRZUTBxdU5oNlJzMHN1bEVFV0ptMzAydER0dElydgpzQzZPanRCd2l5Wm8rSkZ6YlpqVmFnUGZnR3BhUUxwZndVWktsanVDbnBXRHpFVGYyTE91NHg4bWVMTWJRVHRYCnRhbHBCekVTQUtBL2p1akRzSG9CU1VBRzVRUnJwR3Q0eWhSd3lQNXcyWll4NUFUcUlpdFVCVEc4UGVFM1hpL2QKK3hLTUVrdkRKTGh1bDI0RXQzamc4SEVXWEl2VXVMSTZORlFMdUFtOXFXT0tNVGE5WmNnUVYzNXMwMlIxSzJ0Zwp4S3hNQ0gvcDJEZkN0NldhamFTOEZCNWptWnJHQkQ4c3ZXV1hSY1Fxby82ZzhIWE5GUzR0MCtBVVFYZUFSZXNNCk8zbm8rekg5QWdNQkFBRUNnZ0VBRU1IT3RLV20xS2RCVFFWKzlaTnZkY2pPbDZXdm03STlqc2JvRUJBSkxjTTQKUHl1dnRzdHNKQWtzU0E5SS85MURQMEh4UGoxbWpWdWwwclljUzJJQTVGc2IvSy8weVVzNFFlbVZvRGVwRi82dwpxck5tMURpeUEwK3ZwTkVJRGM0RjhWM2drcWVvQWtteTNxWmVIMEZuSy9GUUp2RzhTOFJKSEZCZ1N6QjA4bHVmCjBGTXgrRmswM0FRVi85RWVwek9wMnA1b2J4OHBGVGxvOWlDTitnaXpNNFBscytSVW5FV2xwUUcrVGJsRE1HdVkKSEw4MmNUU0lmaDluVko3dmRYcm5yWExnc2VTZUZNSTQ0SHpXMWREa0QyU1RVUUtja2N1NzVBZEhDd3FWNzFTUwpWKzBBK2dIT3dJQTZaVnZyckZqVDg1M3lxVG01WjFrRnN3YVFyYW5la1FLQmdRRGx4MWE3bW03UzdQcjlrTjF2Clo5NnBsdFNFQ3dDdWptM0Vrdno1aWZYelZ2eUU5ck1YQzExRG9CVXIyeUU3SzlRSy9ZVzNXOFRLY055SVFkY1QKMGJ2eWpxZjBrUDBiZWxyQ3lqdjJvR25tblBQbWNaL2YvZTJZbUk4YUlpcGRjdDNtLytSNzlpQ2xmQUZGMkUwTQoyK01zSG9VSFNWTCt3dGEzckxyWWh1bEdyUUtCZ1FETS9VVGlhbjlqdnNLSTVIeVdLT3U5bWZkWHl3TU5PTXJzCjNMaTM5SG1PalIwakJMQVd2ZVZOMVY0K1M1b21FcU1kcWMxSDgyZ1UvalZwN3hObGhZOEsyM3YvL043VS8rZnUKYWkwckhqNkZDMGtrcDJGSU5JellteGNBSlZ1QzJtbjhQWTgrRHQzMFF1c0o4dzNCSWxOcTFQTWRVdFZsbU9KdQoranBLN2FvU2tRS0JnQTNEMFVoUHlnL01yb1IrSnlYRFhTMWZvYjkvUVQwenZ4T2xrbzRJVzdtR0huNkFvTjNpCmltWEFzMFA3VHBSUzNkTUN1UDN3KzJyOU05amR5TnFoRjlkQ0FJSEFKY2w5bk81S1d5azlGdHIvMEFTZ0RlbkgKTm5LTHdSYlpzUndFQTVNUkJVai94NWppUXRsQ1NldFpTTlNkeDI1V1VDaCsxNG9OU093cnVOSEpBb0dBQ3BUYwpWRys0NmJZMEpvcmMzNGQzTzg5UjFFZFhmZnc3aFdTVGFIT0hQdE9MK0gzS2RUSVNQeVZQZXhtOStFOG4rbVVFCmdyMU8xeDZVTlVheEVxR0ZVOE1tc0gwbUo0cWFOMVZseFg4SExTajYrcGhsVGl2Z1JXSWtHczdTM1h0VzB6MSsKUW03VUNFTFlEU2h0d2xWNlJ0NTlPanRIWnJvd25oZnVvR1dLVFBFQ2dZQklYNVNLSDg0bldWTzJQSkF3cEUzcgphWFg5L2FxOHN2UVc4aXdSQWpjbmFHRlBkQklsRVM0VURRSlZ6Y3RLT21yck9uUGt6TkU4K1AvSXV2WVFuNGljCktmbU04WW9Melo2NE5QaWIrbndQMlp3TzNUbG45MlovTHJTYUloekJiQ09MZkpJcmhnU3VoeG1yVVdwUG5VN1YKMEZ4SWNvZmhkT1lDNEwwRWxPd1hkZz09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
  owner: root:root
  path: /etc/docker/registry/ca.key

disable_root: false
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud
runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh ]
  - [ /root/prepare.sh ]
  - [ /usr/sbin/usermod -aG docker ubuntu ]
  - [ /usr/bin/systemctl, enable, docker.service ]
  - [ /usr/bin/systemctl, enable, docker-registry.service ]
